# Questions_TP02

The network architecture:

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image.png)

### **Question 1**. Write the IP address and the Ethernet port number assigned to each of the 3 PCs. Verify the connectivity with the help of the ping tool. If you encounter connectivity issues, try again after a few seconds and explain what you are observing.

pc1: eth0 / IP: 10.10.1.1

pc2: eth0 / IP: 10.10.2.2

pc3: eth0 / IP: 10.10.3.3

---

### **Question 2.** With the help of the traceroute tool, show the path between the three PCs.

PC1-> PC2

[https://lh7-rt.googleusercontent.com/docsz/AD_4nXdbqGyp-sIMSSl3QLXO9dssjSoYj7XpCr4y0Nlb1aSky0kch2P8THoc-2oiqhVubDo36WJMR7RrN8gEMTvAD9rLWPA06oi275kVfn5N35z2aApuKdnYMJ_i3mqN988an_a9cvLLjyFXyYQd2Tk-7O7xWMk?key=l0uoOcZbjfL7a6ZDrdgnGA](https://lh7-rt.googleusercontent.com/docsz/AD_4nXdbqGyp-sIMSSl3QLXO9dssjSoYj7XpCr4y0Nlb1aSky0kch2P8THoc-2oiqhVubDo36WJMR7RrN8gEMTvAD9rLWPA06oi275kVfn5N35z2aApuKdnYMJ_i3mqN988an_a9cvLLjyFXyYQd2Tk-7O7xWMk?key=l0uoOcZbjfL7a6ZDrdgnGA)

PC1 -> PC3

[https://lh7-rt.googleusercontent.com/docsz/AD_4nXeDlTlnLzc4GpsgRpoG47WMyAoUGnkD0wdM8ULanhCLvareXUqzgkxW-x56rh5NS4a4CvKfQue6sNvoARmRqZxZZKcMtSUvZEvivqbNO1r3wJPHlTTptTSmE2TH8EcrlbQzqRSWSx6JQtvN_hn6i62Ye0w?key=l0uoOcZbjfL7a6ZDrdgnGA](https://lh7-rt.googleusercontent.com/docsz/AD_4nXeDlTlnLzc4GpsgRpoG47WMyAoUGnkD0wdM8ULanhCLvareXUqzgkxW-x56rh5NS4a4CvKfQue6sNvoARmRqZxZZKcMtSUvZEvivqbNO1r3wJPHlTTptTSmE2TH8EcrlbQzqRSWSx6JQtvN_hn6i62Ye0w?key=l0uoOcZbjfL7a6ZDrdgnGA)

PC2 -> PC1

[https://lh7-rt.googleusercontent.com/docsz/AD_4nXcPi_41-ZL8X5J0QMQHjkmiO_b63pJUyGMhMSyQndgWwbTiG8ueKoaMATCg2pUJ4tBQE8OPjz9OrauKk_2ZqUX5wBlX4Hh9AzVP6rDWWM-v2lc6Q69uVWHfyPK1yeRmFlVJKumykqmEvHvk3gzcz8R3FJnD?key=l0uoOcZbjfL7a6ZDrdgnGA](https://lh7-rt.googleusercontent.com/docsz/AD_4nXcPi_41-ZL8X5J0QMQHjkmiO_b63pJUyGMhMSyQndgWwbTiG8ueKoaMATCg2pUJ4tBQE8OPjz9OrauKk_2ZqUX5wBlX4Hh9AzVP6rDWWM-v2lc6Q69uVWHfyPK1yeRmFlVJKumykqmEvHvk3gzcz8R3FJnD?key=l0uoOcZbjfL7a6ZDrdgnGA)

PC2 -> PC3

[https://lh7-rt.googleusercontent.com/docsz/AD_4nXco4yYd4KRY7ExuZgyJ5tnkdjzresXIfIc0R2u0bvA94Aav-ZNfvO78QteKjF-TpycmVhTgAsqDWeO4TB-Okb_enEs-rx-d71rxevE7VdVF2DYz5JoFPinrMpa6qU5AmkXM9S8X0rajSzeQtUSJZWkwaLEX?key=l0uoOcZbjfL7a6ZDrdgnGA](https://lh7-rt.googleusercontent.com/docsz/AD_4nXco4yYd4KRY7ExuZgyJ5tnkdjzresXIfIc0R2u0bvA94Aav-ZNfvO78QteKjF-TpycmVhTgAsqDWeO4TB-Okb_enEs-rx-d71rxevE7VdVF2DYz5JoFPinrMpa6qU5AmkXM9S8X0rajSzeQtUSJZWkwaLEX?key=l0uoOcZbjfL7a6ZDrdgnGA)

PC3-> PC2

[https://lh7-rt.googleusercontent.com/docsz/AD_4nXfQwsO-VPfU8BsHe48qI80W4kQilLFB4CnOuBup3muIRwUMdhyi9YfVNZyEm_exsEB-jkP778NTMt1uVGVpcqNRpyBusv1j4e2wZdeG51a_9_A5sLHOzoHelOlE44jq10BpX8-593NolZaeGaLfINXffIs9?key=l0uoOcZbjfL7a6ZDrdgnGA](https://lh7-rt.googleusercontent.com/docsz/AD_4nXfQwsO-VPfU8BsHe48qI80W4kQilLFB4CnOuBup3muIRwUMdhyi9YfVNZyEm_exsEB-jkP778NTMt1uVGVpcqNRpyBusv1j4e2wZdeG51a_9_A5sLHOzoHelOlE44jq10BpX8-593NolZaeGaLfINXffIs9?key=l0uoOcZbjfL7a6ZDrdgnGA)

PC3 -> PC1

[https://lh7-rt.googleusercontent.com/docsz/AD_4nXeKy8KUOPde2tUdr0GllxSeAQzJhRgY4O6qqzNY1RXan2y04odt86Oi866T52SZPkJJT_HMHhr5caCiCU-qp0V2Q7mvHOqfPVZc5j9j4Rxf-v6Dc-yc0-cpfiKknQRnJ52pwC2qWJJQ40xV9hYgn7dZ8RkV?key=l0uoOcZbjfL7a6ZDrdgnGA](https://lh7-rt.googleusercontent.com/docsz/AD_4nXeKy8KUOPde2tUdr0GllxSeAQzJhRgY4O6qqzNY1RXan2y04odt86Oi866T52SZPkJJT_HMHhr5caCiCU-qp0V2Q7mvHOqfPVZc5j9j4Rxf-v6Dc-yc0-cpfiKknQRnJ52pwC2qWJJQ40xV9hYgn7dZ8RkV?key=l0uoOcZbjfL7a6ZDrdgnGA)

---

### **Question 3.** How many LSAs are available in the database (of type router and network LSA in particular)? Hint: look for the values LS-type: router-LSA or LS-type: network-LSA

LS-type -> router-LSA

Link ID         ADV Router      Age  Seq#       CkSum  Link count

1.1.1.1         1.1.1.1          474 0x80000007 0x4fc9 5

2.2.2.2         2.2.2.2          505 0x80000007 0x0998 6

3.3.3.3         3.3.3.3          476 0x80000007 0x6867 5

4.4.4.4         4.4.4.4          465 0x8000000b 0xe67c 7

5.5.5.5         5.5.5.5          506 0x80000006 0x73af 1

6.6.6.6         6.6.6.6          536 0x80000007 0x9651 2

LS-type -> network-LSA

Link ID         ADV Router      Age  Seq#       CkSum

10.10.99.6      6.6.6.6          446 0x80000003 0x651d

---

### **Question 4.** What is the frequency of transmission of Hello packets? How did you verify it?

freq = 10s with tcpdump for verify the frequency

root@r3:/# tcpdump -i eth0

tcpdump: verbose output suppressed, use -v[v]... for full protocol decode

listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes

09:11:40.212937 IP 10.10.23.2 > 224.0.0.5: OSPFv2, Hello, length 48

09:11:40.369127 IP 10.10.23.3 > 224.0.0.5: OSPFv2, Hello, length 48

09:11:50.213925 IP 10.10.23.2 > 224.0.0.5: OSPFv2, Hello, length 48

09:11:50.369210 IP 10.10.23.3 > 224.0.0.5: OSPFv2, Hello, length 48

09:12:00.214086 IP 10.10.23.2 > 224.0.0.5: OSPFv2, Hello, length 48

09:12:00.369902 IP 10.10.23.3 > 224.0.0.5: OSPFv2, Hello, length 48

09:12:10.214653 IP 10.10.23.2 > 224.0.0.5: OSPFv2, Hello, length 48

09:12:10.370053 IP 10.10.23.3 > 224.0.0.5: OSPFv2, Hello, length 48

09:12:20.215229 IP 10.10.23.2 > 224.0.0.5: OSPFv2, Hello, length 48

09:12:20.370613 IP 10.10.23.3 > 224.0.0.5: OSPFv2, Hello, length 48

09:12:30.215308 IP 10.10.23.2 > 224.0.0.5: OSPFv2, Hello, length 48

09:12:30.370830 IP 10.10.23.3 > 224.0.0.5: OSPFv2, Hello, length 48

09:12:40.215844 IP 10.10.23.2 > 224.0.0.5: OSPFv2, Hello, length 48

09:12:40.371028 IP 10.10.23.3 > 224.0.0.5: OSPFv2, Hello, length 48

09:12:50.216567 IP 10.10.23.2 > 224.0.0.5: OSPFv2, Hello, length 48

09:12:50.371073 IP 10.10.23.3 > 224.0.0.5: OSPFv2, Hello, length 48

---

### Question 05: How adjacencies are acknowledged (i.e. how does one router know that communication can take place in both directions)?

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image%201.png)

In the OSPF protocol, adjacencies between routers are maintained and confirmed through the exchange of "Hello" packets. In the example shown by the `show ip ospf neighbor` command, we observe two active adjacencies with routers 2.2.2.2 and 4.4.4.4, both in the **Full/DROther** state. This state indicates that the adjacencies are fully established, but these routers are neither the Designated Router (DR) nor the Backup Designated Router (BDR) on the network, assuming the role of DROther.

Each entry in the neighbor table also shows a **Dead Time**, representing the remaining time before the connection with the neighbor is considered failed if no new Hello packets are received. In this case, the Dead Time for both neighbors is around 33 seconds, indicating that bidirectional communication is active.

---

### Question 06: Show a simplified representation of the OSPF database and the OSPF routing
table on two different routers. Are they the same? What are the differences?

| Destination Network | Cost on Router R1 | Outgoing Interface on R1 | Cost on Router R3 | Outgoing Interface on R3 |
| --- | --- | --- | --- | --- |
| 10.10.1.0/24 | 10 | eth0 | 30 | eth0, eth2 |
| 10.10.2.0/24 | 30 | eth1 | 10 | eth1 |
| 10.10.3.0/24 | 35 | eth2 | 30 | eth2 |
| 10.10.12.0/24 | 10 | eth1 | 20 | eth0 |
| 10.10.14.0/24 | 15 | eth2 | 20 | eth2 |
| 10.10.23.0/24 | 20 | eth1 | 10 | eth0 |
| 10.10.24.0/24 | 20 | eth1 | 20 | eth0, eth2 |
| 10.10.34.0/24 | 25 | eth2 | 10 | eth2 |
| 10.10.99.0/24 | 25 | eth2 | 20 | eth2 |

Analysis:

1. **Cost Differences**: The routes to various networks have different costs between R1 and R3, reflecting differences in the routers' positions and the OSPF metrics calculated for each.
2. **Outgoing Interfaces**: For some routes, the routers use different outgoing interfaces to reach the same network. For example, in the `10.10.1.0/24` network, R1 uses only `eth0`, while R3 uses both `eth0` and `eth2`.
3. **Direct Routes**: Both routers have directly connected routes, resulting in lower costs for directly accessible networks, such as `10.10.2.0/24` for R3 and `10.10.1.0/24` for R1.

This table demonstrates that, although both routers share routing information about the same networks, differences in cost and interface reflect their specific positions and connections within the network topology.

---

### Question 07: What is the convergence time in this scenario? Describe what has happened and find the new route between the two servers in the new scenario. Can you infer how many packets have been lost via the ping command?

Experimental procedure:

- On one terminal, connect to PC1 and launch traceroute between PC1 and PC2. Double-check that the route involves R2.

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image%202.png)

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image%203.png)

- On the same terminal, start a ping between PC1 and PC2 (and vice versa if you want...)

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image%204.png)

- On a second terminal, connect to to R1 and listen to all the packets received from any interface with the command `tcpdump -i any`

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image%205.png)

- On a third terminal, cd to the main folder of the lab (on your host operating system) and kill the container of R2.

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image%206.png)

- In order to do so, get the information of the R2 container, and use the following commands: `sudo docker container ls`
- Find the hash code associated with R2, and then do: `sudo docker container kill 54a4f0d94715` (Container ID R2 : 54a4f0d94715)

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image%207.png)

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image%208.png)

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image%209.png)

**Resposta:**

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image%2010.png)

1. **What Happened?**
    - During the simulated failure, router R2 was disconnected, causing an interruption in the path between PC1 and PC2. OSPF detected the link failure and began recalculating routes to find an alternative path.
    - During this time, router R1 sent “Destination Host Unreachable” messages (as shown in the ICMP response `From 10.10.1.254`) while waiting for the OSPF convergence process to complete.
2. **New Route Between Servers**:
    - After convergence, OSPF established a new route that does not pass through R2. This was indicated by the resumption of ICMP responses without “Destination Host Unreachable” error messages.
    - To check the new path, you can use the `traceroute` command after convergence to observe the new route between PC1 and PC2.
3. **Packets Lost**:
    - A total of 224 packets were transmitted, of which 191 were received, resulting in **33 packets lost** during the convergence period, as indicated by the ping statistics (`14.7% packet loss`).
    - Most of these packets were lost between `icmp_seq=181` and `icmp_seq=213`, while OSPF was recalculating the new route.

The convergence time was approximately 34 seconds, and during this period, 33 ICMP packets were lost. After convergence, OSPF found an alternative path, restoring communication between PC1 and PC2 via a new route that bypassed R2.

---

### Question 08: With the help of the show ip ospf route command, can you tell what is the cost of reaching PC2 from the router R1? What would have been the cost of reaching this PC when the intermediate router was taken down? Explain your findings.

With R2 working

Path cost for PC2(10.10.2.2) = 30

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image%2011.png)

With R2 not working

Path cost for PC2(10.10.2.2) = 35

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image%2012.png)

- **Cost with R2 Active**:
    - When router R2 is active, the shortest path between R1 and PC2 is:
        - **R1 → R2 → R3 → PC2**
    - The total cost of this path was identified as **30**.
    - This value reflects the OSPF cost metric for this route, summing up the individual costs of links R1-R2, R2-R3, and R3-PC2.
    - This path is the most efficient, as it goes directly through R2, optimally connecting R1 and R3.
- **Cost with R2 Out of Operation**:
    - When R2 is down, OSPF recalculates the routes and selects an alternative route to reach PC2, going through:
        - **R1 → R4 → R3 → PC2**
    - The total cost of this path was identified as **35**.
    - This value is higher than the original cost, indicating that the absence of R2 forces the traffic to take a less efficient and longer path through R4.
    - Although the new path maintains connectivity, it has a higher cost, which may introduce greater latency in communication between R1 and PC2.
- **Conclusion**:
    - The OSPF protocol can dynamically recalculate routes in response to failures, maintaining connectivity even when an intermediate router fails.
    - However, as observed, the absence of R2 leads to an increase in the route cost between R1 and PC2, rising from 30 to 35.
    - This increase in cost highlights how network topology and the presence of direct paths influence route efficiency and the overall performance of the network.

---

### Question 09: Change the configuration such that a new path is taken between PC1 and PC2. How would you do it? Is the reverse path from PC2 to PC1 affected by your changes? Justify your results.

Traceroute PC1→PC2 and PC2→PC1 with the modifications 

New path: R1 → R4 → R3 → PC2

(`telnet localhost ospfd`   `enable`  `configure terminal`   `interface eth1`   `ip ospf cost 500` )

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image%2013.png)

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image%2014.png)

Traceroute PC1→PC2 and PC2→PC1 without the modifications

Default path: R1 → R2 → R3 → PC2

(`telnet localhost ospfd`   `enable`  `configure terminal`   `interface eth1`   `ip ospf cost 500` )

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image%202.png)

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image%203.png)

1. **Impact of the Change on the Path Between PC1 and PC2**
    - With the increased cost on R1's outgoing interface (or on the R2-R3 link if configured on R2), OSPF will recalculate the shortest path between PC1 and PC2. Now, the traffic should follow the path **R1 → R4 → R3 → PC2**.
    - This configuration is useful for "forcing" traffic to use alternative routes in test scenarios or for avoiding a congested link in a production network.
2. **Is the Reverse Path from PC2 to PC1 Affected?**
    - No, the reverse path from **PC2 to PC1** will not be directly affected by this change. This is because the OSPF cost is configured in a specific direction, meaning the cost is assigned from one router to another through an interface.
    - In the reverse path, **PC2 → R3 → R2 → R1 → PC1**, the cost of the R2-R1 link remains unchanged, so OSPF will maintain the most efficient path in the reverse direction, as long as its cost remains lower than the new alternative path.
    - Therefore, the route **PC2 → R3 → R2 → R1 → PC1** will continue to be used, assuming the reverse path cost remains unmodified.

**Justification**

- The OSPF protocol calculates routes based on the costs assigned to each link in a unidirectional manner. Changing the cost of a link affects only the direction in which the cost was modified.
- This characteristic of OSPF allows different paths to be used for forward and return traffic between two points, which is common in networks where bandwidth or routing policy requires more detailed control.

---

### Question 10: Which device is the Designated Router/Backup router? What are the elements involved in the decision process?

Commands: (`telnet localhost ospfd` `show ip ospf neighbor` `show ip ospf neighbor detail`)

![image.png](Questions_TP02%2012ea7959f969800f9027fa8273e32e41/image%2015.png)

1. **Identification of the DR and BDR**
    - According to the results from commands executed on R4, the Designated Router (DR) and Backup Designated Router (BDR) for the subnet `10.10.99.0/24` (the network shared between R4, R5, and R6) are:
        - **DR (Designated Router)**: R6, with IP address `10.10.99.6`
        - **BDR (Backup Designated Router)**: R5, with IP address `10.10.99.5`
    - R4 is in the **DROther** state for this network, meaning it is neither the DR nor the BDR.
2. **Elements Involved in the Decision Process**
    - The DR and BDR election in an OSPF multi-access network (such as the `10.10.99.0/24` subnet) follows a process based on two main criteria:
        - **OSPF Interface Priority**: Each OSPF router can have a priority configured for its interfaces in the network. The router with the highest priority is preferred as the DR. In this case, all routers have a priority of **1**, so priority is not the deciding factor.
        - **Router ID**: When all routers have the same priority, the router ID is used as a tiebreaker. The router with the highest ID is chosen as the DR, and the second-highest ID is chosen as the BDR.
            - In this case, R6’s ID is **6.6.6.6** (the highest ID among R4, R5, and R6), making it the DR.
            - R5’s ID is **5.5.5.5** (the second-highest ID), making it the BDR.
    - Other routers (such as R4) become **DROthers**, meaning they do not have DR or BDR responsibilities but maintain adjacencies with the DR and BDR for communication.
3. **Process Explanation**
    - The DR and BDR election occurs to prevent the duplicate generation of **network LSAs** (Link-State Advertisements) in a multi-access network. With the DR designated to generate network LSAs, the subnet `10.10.99.0/24` has only one LSA, reducing traffic and processing load.
    - The DR is responsible for managing link-state updates on the subnet, while the BDR assumes the role of the DR if the current DR fails.

**Conclusion**:

- In the observed scenario, **R6** (10.10.99.6) is the DR, and **R5** (10.10.99.5) is the BDR.
- The determining factors were the interface priorities (equal across routers) and the router ID, with the highest ID serving as the tiebreaker.

This configuration allows the `10.10.99.0/24` subnet to function efficiently, with the DR (R6) generating network LSAs and the BDR (R5) ready to assume this responsibility if necessary.

---

### Question 11: Provide the configuration snippet (i.e. the modifications you made) and briefly justify it. Is there another way to influence the DR/BDR election process?

1. **Configuration Snippet**
    - To ensure that router R4 is elected as the DR (Designated Router) in the `10.10.99.0/24` subnet, we modified the OSPF interface priority in R4's `ospfd.conf` configuration file. The configuration snippet is as follows:
    
    ```nasm
    interface eth1
    ip ospf priority 100
    
    ```
    
    - This configuration sets the priority of the **eth1** interface (which connects R4 to the `10.10.99.0/24` subnet) to **100**, a value higher than the default priority of 1 for other routers (R5 and R6) on this network. As a result, R4 will be preferred in the DR election during the next OSPF startup.
2. **Justification**
    - In the OSPF protocol, the election of the DR and BDR in a multi-access network (such as the `10.10.99.0/24` subnet) is primarily based on the OSPF interface priorities. The router with the highest priority is elected as the DR, while the router with the second-highest priority is elected as the BDR. If priorities are the same, the **Router ID** serves as a tiebreaker.
    - By setting the **eth1** priority on R4 to **100**, we ensure that R4 is preferred as the DR since its priority value is now higher than those of other routers on the same network.
3. **Alternative to Influence the DR/BDR Election**
    - In addition to explicitly setting the interface priority, another way to influence the DR/BDR election is by **controlling the startup order of routers**.
    - The DR and BDR are elected when OSPF is initially started in a multi-access network. If R4 is the last router to start, it may be chosen as the DR, as long as no other router has a higher priority.
    - However, this approach is less reliable than setting the interface priority because it depends on the startup order and does not guarantee DR status for R4 in future restarts.

**Conclusion**: Configuring the interface priority is the most direct and reliable way to ensure R4 is the DR in the `10.10.99.0/24` subnet. Changing the startup order of routers is an alternative but is less precise and may not keep R4 as the DR in all scenarios.

---

### Question 12: What happens on router R1? Can you still see the request/reply of the ICMP packets? Is the connection maintained? Explain your findings.